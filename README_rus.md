# Добро пожаловать в проект «Сам сабе ЦВК»!

Проект «Сам сабе ЦВК» (русс. «Сам себе ЦИК», eng. DIY election board) предоставляет протокол и инфраструктуру для того, чтобы честно и независимо подсчитать результаты выборов.

## Обзор проекта

Ниже мы объясним вам, как работает проект «Сам сабе ЦВК»

![Overview diagram](./doc/image/overview.svg)

1. Выберите в избирательном бюллетене своего кандидата, поставьте отметку возле его/ее имени. Старайтесь, чтобы отметка была ясной и четкой.

2. Откройте свой паспорт на последней странице (с фото), разместите его под строкой с именем выбранного кандидата, как показано на картинке, и сфотографируйте бюллетень и паспорт (это должно быть одно фото!).

3. Бюллетень опустите в избирательную урну.

4. Свое фото обработайте в приложении от «Сам сабе ЦВК». В результе вы получите «цифровой бюллетень» — картинку, на которой видна часть вашего бюллетеня с выбранным кандидатом и цифровая подпись в виде решетки из цветных квадратиков. Решетка нужна для распознавания бюллетеня компьютером. Цифровая подпись состоит из трех частей: кода действительности паспорта, цифровой подписи избирателя и элекронной подписи, подтверждающей целостность бюллетень. Код действительности паспорта опирается на данные по стране, сроку действия (проверяем, что паспорт действителен) и вашей дате рождения (вы должны быть совершенолетним на момент участия в выборах). Цифровая подпись выборщика — это зашифрованная информация о вашем имени, номере паспорта и индивидуальном номере паспорта. Цифровая подпись, подтверждающая целостность документа — это хэш исходной фотографии и остальных частей подписи.

5. Получившийся «цифоровой бюллетень» отправьте на сайт альтернативной избирательной комиссии «Сам сабе ЦВК».

6. Сайт альтернативной избирательной комиссии «Сам сабе ЦВК» автоматически, по специальной процедуре, сравнивает все полученные пары бюллетеней и таким образом проверяет, что от каждого избирателя получен только один голос (исключается «накрутка» голосов за какого-либо кандидата). Если в систему попадают два или больше бюллетеней с одинаковыми паспортными данными, все они признаются недействительными и не учитываются при дальнейшем подсчете голосов.

7. После окончания голосования система публикует результаты.


Важно понимать, что при сравнении бюллетеней система сравнивает не реальные личные данные паспортов, а только их коды, зашифрованные в виде разноцветной решетки. Ни система «Сам сабе ЦВК», ни какая-либо третья сторона не могут расшифровать этот код и таким образом получить реальные паспортные данные (8). С другой стороны, даже зная реальные паспортные данные, невозможно идентифицировать по ним соответствующий бюллетень, потому что подпись каждый раз разная (9). 

## Voter’s signature

## Подпись избирателя

Подпись избирателя — это основная составляющая предложенной схемы. Под этим термином здесь и далее будет пониматься только та часть всей подписи, которая шифрует юридический ID избирателя. Другие части подписи называются по-другому. Юридический ID избирателя — это число, основанное на личных данных, извлеченных из фотографии паспорта, а именно: имя и фамилия, дата рождения, серия и номер паспорта, а также его идентификационный номер (если есть). Юридический ID изменяется каждые выборы. Это достигается хэшированием   паспортной информации и кодовой фразы или открытого ключа, специфических для каждых выборов.

Существуют три основные требования к кодированию подписи избирателя:

1) По подписи избирателя невозможно частично или полностью восстановить паспортную информацию или юридический ID.

2) Невозможно, зная полную или частичную паспортную информацию или юридический ID, восстановить подпись избирателя и таким образом идентифицировать конкретный бюллетень. Алгоритм каждый раз генерирует новую подпись избирателя для одного и того же юридического ID.

3) Для любой пары подписей существует быстрый алгоритм, позволяющий без расшифровки данных определить, получены ли эти подписи для одного юридического ID или для разных. Вне зависимости от результата проверки не может быть получено никакой дополнительной информации касательно этих юридических ID. 

Возможность и скорость в предыдущем абзаце понимаются как обычно в ассиметричном шифровании. «Быстро и возможно» означает, что существует алгоритм с полиномиальным временем работы, в то время как «медленно и невозможно» означает, что существует только алгоритм с экспоненциальным временем работы. Параметры этого алгоритма таковы, что перебор или другой экспоненциальный алгоритм занял бы значительное время, например, сопоставимое с длительностью человеческой жизни или превышающее его. Типичный часто используемый в криптографии пример ассиметричной пары функций  — это дискретное возведение в степень `O(n)` и дискретное логарифмирование `O(exp(n))`, где `n` это количество битов в ключе.

Протокол для подписи избирателя основан на задаче о миллионерах-социалистах. Общие сведения о ней можно найти на https://en.wikipedia.org/wiki/Socialist_millionaire_problem, а сам алгоритм опубликован в Fabrice Boudot, Berry Schoenmakers, Jacques Traoré (2001). "A Fair and Efficient Solution to the Socialist Millionaires' Problem". Discrete Applied Mathematics. 111 (1). pp. 23--36.

Предположим, что у нас есть альтернативная избирательная комиссия (АИК), основанная на нашем проекте и избиратели, которых по криптографической традиции мы назовем Алиса и Боб. В этом случае протокол следующий:

1) АИК выбирает длинное простое число  `p` и случайный не единичный элемент  `h` кольца по модулю `p`.  `h` это корень из единицы (как и каждый элемент кольца по простому модулю), тем не менее, необходимо, чтобы `h` был корнем из единицы высокого порядка. Последнее может быть гарантировано, если `p`  является таким простым числом, что `(p - 1) / 2` — тоже простое число.

2) АИК генерирует два случайных числа  `k1` и `k2`.

3) АИК вычисляет  `g1 = h ^ k1` и `g2 = h ^ k2`.

4) АИК делает публичными `p`, `h`, `g1`, `g2`.

5) Избиратель Алиса имеет уникальный юридический ID `x`, который злая Ева может узнать из какого-либо внешнего источника.

6) Алиса генерирует случайное число `r` и вычисляет `P = g2^r` and `Q = h^r * g1^x`, она не сохраняет `r`.

7) Алиса отправляет в АИК бюллетень, содержащий 2 части подписи избирателя `P` and `Q`.

8) АИК проверяет, что ни один другой бюллетень не имеет таких же  `P` и `Q`. Если же какие-то числа совпадают, АИК просит Алису повторить шаги 5—7. Совпадения должны быть редкими, если `h` это корень высокого порядка из единицы и существует много возможных `r`.

9) Прежде, чем считать голоса, АИК проверяет все пары бюллетеней: он вычисляет `(Q_a / Q_b)^k2 == P_a / P_b`  если верно, то оба бюллетеня считаются недействительными. 

| Алиса                                | АИК                                |
|----------------------------------------|------------------------------------|
| юридический ID `x`                     | простое `p`, случайное `h`              |
|                                        | генерирует случайные `k1`, `k2`         |
|                                        | вычисляет `g1 = h^k1`, `g2 = h^k2` |
|                                        | проверяет `g1 != 1`, `g2 != 1`          |
|                                        | публикует `p`, `h`, `g1`, `g2`, `k2` |
| генерирует  случайное  `r`                    |                                    |
| вычисляет `P = g2^r`, `Q = h^r * g1^x` |                                    |
| незащищенно посылает `P`, `Q`                 |                                    |
|                                        | проверяет `P != P_i`, `Q != Q_i`        |
|                                        | вычисляет `c = (Q_i / Q)^k2`       |
|                                        | проверяет `P_i / P == c`                |

Как работает проверка? Возьмем двух избирателей — Алису и Боба. У Алисы юридический ID `x`, она генерирует случайное число `r`, чтобы вычислить `P_a` и `Q_a` согласно правилам. А у Боба юридический ID `y`, он генерирует `s` и вычисляет`P_b` and `Q_b`. Мы проверили, что `P_a != P_b`, поэтому мы уверены, что `r != s`. Теперь АИК вычисляет `(Q_a / Q_b)^k2) == (h^(r + k1 * x) / h^(s + k1 * y))^k2 == h^(k2 * (r - s) + k1 * k2 * (x - y))` и `P_a / P_b = h^(k2 * r) / h^(k2 * s) == h^(k2 * (r - s))`. Эти два числа могут быть равны если и только если `x - y == 0`, то есть если Боб это не Боб, а Алиса, которая притворяется Бобом. 
